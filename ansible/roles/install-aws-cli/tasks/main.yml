---
- name: Check if AWS CLI is available
  command: aws --version
  register: aws_cli_check
  failed_when: false
  changed_when: false
- name: Proceed with AWS CLI installation
  block:
    - name: Ensure unzip is installed
      become: true
      package:
        name: unzip
        state: present
    - name: Download AWS CLI
      unarchive:
        src: "https://awscli.amazonaws.com/awscli-exe-linux-{{ ansible_facts.architecture }}.zip"
        remote_src: true
        dest: /tmp/
    - name: Install AWS CLI
      become: true
      command: /tmp/aws/install
  when: aws_cli_check.rc != 0
